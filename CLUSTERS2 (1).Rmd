---
title: "Clusters2"
author: "alexandra Porras"
date: "2022-11-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rio)
DataFINAL= import("https://github.com/davilaluis9/Entrega-1-Estad-stica/raw/main/DataFINAL6.csv")
```

```{r}
str(DataFINAL)
```

```{r}
DataFINAL[,5:11]=lapply(DataFINAL[,5:11],as.numeric)
str(DataFINAL)
```

```{r}
boxplot(DataFINAL[,c(4:11)],horizontal = F,las=2,cex.axis = 0.5)
```

```{r}
cor(DataFINAL[,c(4:11)])
```

---
```{r}
dataClus=DataFINAL[,c(2,4,6:10)]
```
```{r}
row.names(dataClus)=dataClus$pais
dataClus = dataClus[,-c(1)]
```

Para el trabajo de aglomeración o clusterización, se emplearon seis de las ocho variables. Se optó por eliminar las variables "Percepción de la corrupción" y "Desastres naturales" debido a que dificultan realizar una interpretación coherente; es decir, impiden establecer, a fines de interpretación, una jerarquización entre los conglomerados de los países.

```{r}
library(cluster)
g.dist = daisy(dataClus, metric="gower")
```

```{r}
library(factoextra)
fviz_nbclust(dataClus, pam,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F)

#JERARQUICA AGLOMERATIVA
fviz_nbclust(dataClus, hcut,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F,hc_func = "agnes")

#JERARQUICA DIVISIVA
fviz_nbclust(dataClus, hcut,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F,hc_func = "diana")
```
La técnica de jerarquización divisiva (Diana) fue la escogida para el proceso de clusterización debido a que cuenta con el mayor promedio de siluetas (0.27) en comparación a la técnia de partición y jerarquización aglomerativa, cuyas siluetas promedio son 0.24 y 0.23 respectivamente. Asimismo, es importante acotar que, si bien el estadístico gap sugiere que la cantidad óptima de aglomerados o clusters para el modelo es uno (1), se decidió utilizar tres clusters debido a que permite una mejor interpretación y diferenciación visual entre los países. Aquella decisión fue tomada en base a la leve variación en el promedio de las siluetas de la técnica Diana, la cual pasó de 0.31 con dos clusters a 0.27 con tres clusters. El modelo, a su vez, cuenta únicamente con seis países mal clusterizados:Uruguay, Bangladesh, Mongolia, Bhutan, Lithuania y Latvia. En tanto es una cantidad reducida de países, el modelo sugiere ser el más apropiado.


```{r}
#clusterizar via PAM
set.seed(123)
res.pam=pam(g.dist,3,cluster.only = F)
```
```{r}
#Clusterizar via AGNES
set.seed(123)
library(factoextra)

res.agnes<- hcut(g.dist, k = 3,hc_func='agnes',hc_method = "ward.D")
```
```{r}
#Clusterizar via DIANA
set.seed(123)
res.diana <- hcut(g.dist, k = 3,hc_func='diana')
```

```{r}
#Siluetas PAM
library(factoextra)
library (ggplot2)
fviz_silhouette(res.pam,print.summary = F)
```

```{r}
#Siluetas AGNES
fviz_silhouette(res.agnes,print.summary = F)
```
Clusterización via Diana:
```{r}
#Siluetas DIANA
fviz_silhouette(res.diana,print.summary = F)
DataFINAL$diana=res.diana$cluster
dataClus$diana=res.diana$cluster
```

```{r}
library(factoextra)
library(magrittr)
library(kableExtra)
head(dataClus,15)%>%kbl()%>%kable_styling()
```


```{r}
silDIANA=data.frame(res.diana$silinfo$widths)
silDIANA$country=row.names(silDIANA)
poorDIANA=silDIANA[silDIANA$sil_width<0,'country']
poorDIANA
#6 mal clusterizados
```

```{r}
aggregate(.~ diana, data=dataClus,mean)
```
Finalmente, el modelo establece tres grupos de países según sus niveles de criminalidad, desempleo, crecimiento económico, desigualdad, niveles de contaminación (a partir de la camtidad de emisiones de dióxido de carbono) y niveles de deterioro de la paz. El grupo "1" comprende a los países que, a nivel general, presentan los peores niveles en las variables anteriormente mencionadas, a excepción de los niveles de contaminación por emisiones de CO2. El grupo "2", por su parte, comprende a los países que presentan niveles intermedios de criminalidad, desigualdad y deterioro de la paz. Respecto al nivel de desempleo y crecimiento del PBI, estos países cuentan los niveles más bajos entre los tres grupos, pese a que la diferencia con el grupo "3" no es tan lejana. Aquello es especialmente relevante en los niveles de decrecimiento económico ya que la diferencia entre los países del grupo "2" y "3" es, en promedio, menor a 1 punto.Finalmente, los países del grupo "3" son los que cuentan con los niveles más bajos de criminalidad, desigualdad y deterioro de la paz. Si bien han tenido un decrecimiento del PBI ligeramente mayor a los países del grupo "2", sus niveles de desigualdad son menores (la mitad de aquellos) lo cual es importante de analizar ya que, como sugieren autores como Thomas Picketty (2013), indicadores como el PBI pueden nignorar aspectos relevantes de una sociedad como la distribución de la riqueza.
Es importante acotar que los tres grupos presentan un decrecimiento en sus niveles de PBI, siendo los países del grupo 1 los que tienen los niveles más preocupantes. Aquello puede estar relacionado a la crisis que generó la pandemia por el COVID-19 en el 2020, año del cual se tomó la información. En aquel contexto, los países del grupo 1 mostraron ser los más vulnerables ante la crisis. Por otra parte, los altos niveles de emisiones de CO2 de los países del grupo "3" pueden estar relacionados al nivel de desarrollo de su industria. 
---
Análisis geoespacial de clusters:

A continuación, se presenta de forma gráfica los grupos de países anteriormente desarrollados. El grupo 3 está conformdo por 66 países, el grupo 2 por 64 países y el grupo 1 por 17 países.

```{r}
setwd("~/2022-2/Estadistica Analisis Politico 2/Trabajo grupal") #luis acá vas a tener que poner el directorio donde tu tienes el shape file en tu laptop
mapDIS=sf::read_sf("world-administrative-boundaries.shp") #shapefile
head(mapDIS)
```

```{r}
colnames(DataFINAL)[1] = "iso3"
DataFINAL$diana=factor(DataFINAL$diana)
```

```{r}
#Juntamos información con el shape:
mapCONG=merge(mapDIS, DataFINAL, by = "iso3", all.x = T)
```

```{r}
library(ggplot2)
mapaleyendaL= ggplot(mapCONG)+ geom_sf() + theme_light()

mapaleyL= mapaleyendaL + geom_sf(data=mapCONG,
              aes(fill=diana),color = "gray")
      
mapa1= mapaleyL +
coord_sf() + 
scale_fill_manual(values=c("tomato","turquoise","lightgoldenrod1")) + theme_void() +
  
  
theme(axis.title = element_blank(), axis.text = element_blank(), legend.position = "right") + labs(fill=" ") + theme(legend.text = element_text(size = 8)) +
  
labs(title = "Países según grupos") +
  
theme(
plot.title = element_text(color="black", size=17, face="bold"))
mapa1
```
Como se puede apreciar, el grupo 3 está conformado en su mayoría por los países de América del Norte, Europa y Oceanía. También estan presenten ciertos países de América latina como Argentina, Chile y Uruguay, y algunos países de África y Asia como Botswana, Mongolia y Kazhahistan, pero son una minoría. Por su parte, los países del grupo 2 y 1 son mayoritariamente africanos, asiáticos y latinoamericanos (especialmente de Centro y Suramérica). En África, predominan los países del grupo 2, aunque también hay una presencia relevante de países del grupo 1. En Medio Oriente, por su parte, predominan los países del grupo 1. Los países de Asia, por otro lado, pertenecen en su mayoría al grupo 2, aunque varios países relativamente pequeños son parte del grupo 3, tendencia que podría seguir aumentando con la emergencia de los "tigres asiáticos". Finalmente, América latina es una región dividida: los países se dividen entre los tres grupos.Por ejemplo, Brasil, Colombia y México pertenecen al grupo 1;Ecuador, Perú, Bolivia y Paraguay pertenecen al grupo 2; y Argentina, Chiley Uruguay pertenecen al grupo 3. 


```{r}
a=data.frame(table(DataFINAL$diana))
```
```{r}
#*BARPLOT*
library(ggplot2)
g1=ggplot(a, aes(x=Var1, y=Freq))+
  geom_bar(stat = "identity" , color="black", fill="steelblue") + coord_flip() +
labs(title = "Número de países por grupo",
     x = "Grupos",
     y= "Cantidad") +
   geom_text(aes(label=Freq),color="red", size=5)
library(ggthemes)
g1 + theme_stata()
```


















